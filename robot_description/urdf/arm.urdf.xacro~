<?xml version="1.0"?>
<robot    xmlns:xacro="http://www.ros.org/wiki/xacro">



<xacro:include filename="$(find robot_description)/urdf/ur10.transmission.xacro" />
 <!-- <xacro:include filename="$(find robot_description)/urdf/ur10.gazebo.xacro" />-->


<!-- Inertia parameters -->
  <property name="base_mass" value="4.0" />  <!-- This mass might be incorrect -->
  <property name="pi" value="3.14159265" />
  <property name="shoulder_mass" value="7.778" />
  <property name="upper_arm_mass" value="12.93" />
  <property name="forearm_mass" value="3.87" />
  <property name="wrist_1_mass" value="1.96" />
  <property name="wrist_2_mass" value="1.96" />
  <property name="wrist_3_mass" value="0.202" />

  <!-- These parameters are borrowed from the urcontrol.conf file
       but are not verified for the correct permutation.
       The permutation was guessed by looking at the UR5 parameters.
       Serious use of these parameters needs further inspection. -->
  <property name="shoulder_cog" value="0.00008 0.00244 -0.037" />
  <property name="upper_arm_cog" value="0.00001 0.15061 0.38757" />
  <property name="forearm_cog" value="-0.00012 0.06112 0.1984" />
  <property name="wrist_1_cog" value="-0.00021 -0.00112 0.02269" />
  <property name="wrist_2_cog" value="-0.00021 0.00112 0.002269" />
  <property name="wrist_3_cog" value="0 -0.001156 -0.00149" />

  <!-- Kinematic model -->
  <!-- Properties from urcontrol.conf -->
  <property name="ur10_d1" value="0.1273" />
  <property name="ur10_a2" value="-0.612" />
  <property name="ur10_a3" value="-0.5723" />
  <property name="ur10_d4" value="0.163941" />
  <property name="ur10_d5" value="0.1157" />
  <property name="ur10_d6" value="0.0922" />

  <!-- Arbitrary offsets for shoulder/elbow joints -->
  <property name="shoulder_offset" value="0.220941" />  <!-- measured from model -->
  <property name="elbow_offset" value="-0.1719" /> <!-- measured from model -->       

  <!-- link lengths used in model -->
  <property name="shoulder_height" value="${ur10_d1}" />
  <property name="upper_arm_length" value="${-ur10_a2}" />
  <property name="forearm_length" value="${-ur10_a3}" />
  <property name="wrist_1_length" value="${ur10_d4 - elbow_offset - shoulder_offset}" />
  <property name="wrist_2_length" value="${ur10_d5}" />
  <property name="wrist_3_length" value="${ur10_d6}" />

<xacro:macro name="cylinder_inertial" params="radius length mass *origin">
    <inertial>
      <mass value="${mass}" />
      <insert_block name="origin" />
      <inertia ixx="${0.0833333 * mass * (3 * radius * radius + length * length)}" ixy="0.0" ixz="0.0"
        iyy="${0.0833333 * mass * (3 * radius * radius + length * length)}" iyz="0.0"
        izz="${0.5 * mass * radius * radius}" />
    </inertial>
  </xacro:macro>
 




 <xacro:macro name="universal_robot" params="name prefix parent *origin reflect"> 
<!--links-->

    <link name="${prefix}base_link2" >
      <visual>
<origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://robot_description/meshes/Base.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
<origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://robot_description/meshes/base.stl"/>
        </geometry>
      </collision>
<xacro:cylinder_inertial radius="0.075" length="0.038" mass="${base_mass}">
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>

<!--link2-->
<link name="${prefix}shoulder_link">
      <visual>
        <geometry>
          <mesh filename="package://robot_description/meshes/Shoulder.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
<origin rpy="0 0 0" xyz="0 0 0"/>
        <geometry>
          <mesh filename="package://robot_description/meshes/shoulder.stl"/>
        </geometry>
      </collision>
<xacro:cylinder_inertial radius="0.075" length="0.178" mass="${shoulder_mass}">
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>
<!--link3-->
<link name="${prefix}upper_arm_link">
      <visual>
        <geometry>
          <mesh filename="package://robot_description/meshes/UpperArm.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://robot_description/meshes/upper_arm.stl"/>
        </geometry>
      </collision>
      <xacro:cylinder_inertial radius="0.075" length="${-ur10_a2}" mass="${upper_arm_mass}">
        <origin xyz="0.0 0.0 ${-ur10_a2/2.0}" rpy="0 0 0" />
      </xacro:cylinder_inertial>
        
      
    </link>


<!--link4-->
 <link name="${prefix}forearm_link">
      <visual>
         <geometry>
          <mesh filename="package://robot_description/meshes/Forearm.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://robot_description/meshes/forearm.stl"/>
        </geometry>
      </collision>
     <xacro:cylinder_inertial radius="0.075" length="${-ur10_a3}" mass="${forearm_mass}">
        <origin xyz="0.0 0.0 ${-ur10_a3/2.0}" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>


                   <!--link5-->


<link name="${prefix}wrist_1_link">
      <visual>
        <geometry>
          <mesh filename="package://robot_description/meshes/Wrist1.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://robot_description/meshes/wrist_1.stl"/>
        </geometry>
      </collision>
     <xacro:cylinder_inertial radius="0.075" length="0.12" mass="${wrist_1_mass}">
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>
<!--link6-->
<link name="${prefix}wrist_2_link">
      <visual>
        <geometry>
          <mesh filename="package://robot_description/meshes/Wrist2.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://robot_description/meshes/wrist_2.stl"/>
        </geometry>
      </collision>
      <xacro:cylinder_inertial radius="0.075" length="0.12" mass="${wrist_2_mass}">
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>
<!--link7-->
<link name="${prefix}wrist_3_link">
      <visual>
        <geometry>
          <mesh filename="package://robot_description/meshes/Wrist3.dae"/>
        </geometry>
        <material name="LightGrey">
          <color rgba="0.7 0.7 0.7 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://robot_description/meshes/wrist_3.stl"/>
        </geometry>
<surface>
        <friction>
          <ode>
            <mu>100000.0</mu>
            <mu2>100000.0</mu2>
            <slip>0</slip>
            <slip2>0</slip2>
          </ode>
        </friction>
      </surface>
      </collision>
      <xacro:cylinder_inertial radius="0.075" length="0.12" mass="${wrist_3_mass}">
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
      </xacro:cylinder_inertial>
    </link>

<!--link8-->
 <link name="${prefix}ee_link">
      <collision>
        <geometry>
          <box size="0.01 0.01 0.01"/>
        </geometry>
<surface>
        <friction>
          <ode>
            <mu>100000.0</mu>
            <mu2>100000.0</mu2>
            <slip>0</slip>
            <slip2>0</slip2>
          </ode>
        </friction>
      </surface>
        <origin rpy="0 0 0" xyz="-0.01 0 0"/>
      </collision>
    </link>

<!--joints-->


  <!---joint1-->
  
    <joint name="${prefix}joint_torso_fixe" type="fixed">
      <parent link="torso_link_b1" />
      <child link = "${prefix}base_link2" />
      <origin xyz="0.09996 ${reflect*(-0.12)} 0.32214" rpy="1.57 ${(reflect)*(3.14)} ${(reflect-1)*1.57}"/>
			<axis xyz="0 0 ${-reflect}" />
<!--<origin xyz="0.0 ${reflect*(-0.22)} 0.35214" rpy="1.57 ${(reflect)*(3.14)} ${(reflect-1)*1.57}"/>
			<axis xyz="0 0 ${-reflect}" />-->
<!--<limit lower="-2.9570" upper="2.9570" effort="100" velocity="2.26" />
    -->
<dynamics damping="0.0" friction="0.0"/>
</joint>



    <!--joint2-->



 <joint name="${prefix}shoulder_pan_joint" type="revolute">
      <parent link="${prefix}base_link2" />
      <child link = "${prefix}shoulder_link" />
     <!--<origin xyz="0.0 0.0 ${shoulder_height}" rpy="0.0 0 1.57" />
      <axis xyz="0  0 1" />-->
<origin xyz="0.0 0.0 ${shoulder_height}" rpy="0.0 0.0 0.0" />
      <axis xyz="0 0 1" />
<limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="330.0" velocity="2.16"/>
     <dynamics damping="0.0" friction="0.0"/>
    </joint>




   <!--joint3-->





 <joint name="${prefix}shoulder_lift_joint" type="revolute">
      <parent link="${prefix}shoulder_link" />
      <child link = "${prefix}upper_arm_link" />
      <origin xyz="0.0 ${shoulder_offset} 0.0" rpy="0 0 0.0" /> 
      <axis xyz="0 1 0" />
<limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="330.0" velocity="2.16"/>
<dynamics damping="0.0" friction="0.0"/>   
 </joint>







   
   <!--joint4-->

<joint name="${prefix}elbow_joint" type="revolute">
      <parent link="${prefix}upper_arm_link" />
      <child link = "${prefix}forearm_link" />
      <origin xyz="0.0 ${elbow_offset} ${upper_arm_length}" rpy="0.0 0.0 0.0" />
      <axis xyz="0 1 0" />
      <limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="150.0" velocity="3.15"/>
<dynamics damping="0.0" friction="0.0"/>
    </joint>
    <!--joint5-->
   <joint name="${prefix}wrist_1_joint" type="revolute">
      <parent link="${prefix}forearm_link" />
      <child link = "${prefix}wrist_1_link" />
      <origin xyz="0.0 0.0 ${forearm_length}" rpy="0.0 0.0 0.0" />
      <axis xyz="0 1 0" />
          <limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="54.0" velocity="3.2"/>
     
      <dynamics damping="0.0" friction="0.0"/>
    </joint>
   <!--joint6-->
<joint name="${prefix}wrist_2_joint" type="revolute">
      <parent link="${prefix}wrist_1_link" />
      <child link = "${prefix}wrist_2_link" />
      <origin xyz="0.0 ${wrist_1_length} 0.0" rpy="0.0 0.0 0.0" />
      <axis xyz="0 0 1" />
      <limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="54.0" velocity="3.2"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

<!--joint7-->
 <joint name="${prefix}wrist_3_joint" type="revolute">
      <parent link="${prefix}wrist_2_link" />
      <child link = "${prefix}wrist_3_link" />
      <origin xyz="0.0 0.0 ${wrist_2_length}" rpy="0.0 0.0 0.0" />
      <axis xyz="0 1 0" />
      <limit lower="${-1.3*pi}" upper="${ 1.3*pi}" effort="54.0" velocity="3.2"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>
<!--joint8-->

<joint name="${prefix}ee_fixed_joint" type="fixed">
      <parent link="${prefix}wrist_3_link" />
      <child link = "${prefix}ee_link" />
      <origin xyz="0.0 ${wrist_3_length} 0.0" rpy="0.0 0.0 ${pi/2.0}" />
    </joint>
   

<xacro:ur10_arm_transmission prefix="${prefix}" />
   <!-- <xacro:ur10_arm_gazebo prefix="${prefix}" />
-->
<gazebo reference="${prefix}ee_link">
   
           <mu1>100000.0</mu1>
            <mu2>100000.0</mu2>
           
           <kp>100000</kp>
           <kd>2.0</kd>
  </gazebo>
<gazebo reference="${prefix}wirst_3_link">
   
           <mu1>100000.0</mu1>
            <mu2>100000.0</mu2>
           
           <kp>100000</kp>
           <kd>2.0</kd>
  </gazebo>

</xacro:macro>
    
</robot>
